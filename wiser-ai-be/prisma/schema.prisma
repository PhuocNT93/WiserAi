generator client {
  provider = "prisma-client"
  output   = "../src/generated/client"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MEMBER
  MANAGER
  HR
  ADMIN
}

enum Position {
  DEV
  QC
  BA
}

enum UserLevel {
  FRESHER
  JUNIOR
  SENIOR
  PRINCIPAL
}

model User {
  id          Int       @id @default(autoincrement())

  careerPlans   CareerPlan[] @relation("UserCareerPlans")
  managedPlans  CareerPlan[] @relation("ManagerCareerPlans")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  email       String    @unique
  password    String
  name        String
  roles       Role[]    @default([MEMBER])

  level    String?
  jobTitle String?

  skills      UserSkill[]
  refreshTokens RefreshToken[]
  courses     Course[] 

  managerId   Int?
  manager     User?     @relation("UserManagement", fields: [managerId], references: [id])
  subordinates User[]    @relation("UserManagement")

  @@map("users")
}


model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique 
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  revoked   Boolean  @default(false)
  expiresAt DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("refresh_tokens")
}

model UserSkill {
  id          Int      @id @default(autoincrement())
  userId      Int
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  skillName   String
  experience  String?  
  level       String?  
  careerGoal  String?  

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("user_skills")
}

model ConfigData {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  value       String   
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("config_data")
}

model Course {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  category    String?
  imageUrl    String?
  authorId    Int?
  author      User?    @relation(fields: [authorId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("courses")
}

// Master Data - Dat
model RoleSkillMapping {
  id          Int      @id @default(autoincrement())
  position    String
  code        String   @unique
  name        String
  level       String
  description String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("role_skill_mapping")
}
model EmployeeProfile {
  id             Int      @id @default(autoincrement())
  userEmail      String
  engName        String
  empCode        String   @unique
  busUnit        String
  jobTitle       String
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employee_profile_mapping")
}

enum ReviewPeriod {
  SIX_MONTHS
  TWELVE_MONTHS
}

enum GrowthMapStatus {
  DRAFT
  SUBMITTED
  BACK_TO_SUBMIT
  SUCCESS
}

model CareerPlan {
  id                Int             @id @default(autoincrement())
  userId            Int
  user              User            @relation("UserCareerPlans", fields: [userId], references: [id])
  
  // Snapshot of who manages this at time of creation/submission
  managerId         Int?
  manager           User?           @relation("ManagerCareerPlans", fields: [managerId], references: [id])

  year              Int
  reviewPeriod      ReviewPeriod
  status            GrowthMapStatus @default(DRAFT)

  // Step Inputs
  objectives        String          @db.Text
  achievements      String          @db.Text
  certificates      Json?           // Array of { name: string, level: string, fileUrl: string }
  improvements      String          @db.Text
  expectations      String          @db.Text

  // Target Goal
  targetLevel       UserLevel?

  // AI Generated / Result Sections
  careerGoal        String?         @db.Text
  currentCompetencies String?       @db.Text
  focusAreas        Json?           // JSON structure
  actionPlan        Json?           // JSON structure
  supportNeeded     Json?           // JSON structure (or String depending on requirements, usually list items)

  // Manager Review
  managerComments   Json?           // Map of section -> comment
  
  submittedAt       DateTime?
  confirmedAt       DateTime?

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@map("career_plans")
}
